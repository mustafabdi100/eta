{% extends 'base.html' %}
{% block content %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact Person Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            font-size: 0.8rem;
        }
       
    </style>
    <script>
        $(document).ready(function() {
            var contactForms = $('.contact-form');
            var addContactButton = $('#add-contact');
    
            contactForms.not(':first').hide();
    
            addContactButton.click(function() {
                var visibleForm = contactForms.filter(':visible');
                var nextForm = visibleForm.next('.contact-form');
    
                if (nextForm.length) {
                    visibleForm.find('.accordion-header').addClass('active');
                    visibleForm.find('.accordion-content').show();
                    visibleForm.wrap('<div class="accordion"></div>');
                    nextForm.show().find('.accordion-header').trigger('click');
                } else {
                    addContactButton.prop('disabled', true);
                }
            });
    
            $(document).on('click', '.accordion-header', function() {
                var accordionContent = $(this).next('.accordion-content');
                if (!$(this).hasClass('active')) {
                    contactForms.find('.accordion-content').not(accordionContent).slideUp();
                    contactForms.find('.accordion-header').not(this).removeClass('active');
                    $(this).addClass('active');
                    accordionContent.slideDown();
                } else {
                    $(this).removeClass('active');
                    accordionContent.slideUp();
                }
            });
    
            $('form').submit(function(e) {
                var requiredFields = $('#contact-form-1').find('input[required]');
                var emptyRequiredFields = requiredFields.filter(function() {
                    return $(this).val().trim() === '';
                });
                if (emptyRequiredFields.length > 0) {
                    e.preventDefault();
                    alert('Please fill in all the required fields for Contact 1.');
                } else {
                    var invalidOptionalForm = false;
                    contactForms.not(':first').each(function() {
                        var form = $(this);
                        var formFields = form.find('input[required], select[required]');
                        var filledFields = formFields.filter(function() {
                            return $(this).val().trim() !== '';
                        });
                        if (filledFields.length > 0 && filledFields.length !== formFields.length) {
                            invalidOptionalForm = true;
                            form.find('.accordion-header').trigger('click');
                            return false;
                        }
                    });
                    if (invalidOptionalForm) {
                        e.preventDefault();
                        alert('Please fill in all fields for the optional contacts or leave them empty.');
                    }
                }
            });
        });
    </script>
</head>
<body class="bg-white">
    <div class="container mx-auto px-4 py-8">
        <img src="{% static 'images/logo.png' %}" alt="Logo" class="mx-auto mt-4" style="max-width: 100px;">
        <div class="max-w-4xl mx-auto bg-white shadow-lg rounded-lg p-6">
            <form method="post">
                {% csrf_token %}
                <div id="contact-form-1" class="contact-form mb-6">
                    <fieldset class="mb-6">
                        <legend class="text-xl font-semibold mb-4 text-green-800">Contact 1 Details</legend>
                        <!-- First Name -->
                        <div class="mb-4">
                            <label for="id_1-first_name" class="block text-sm font-medium text-gray-700">First Name:</label>
                            <input type="text" name="1-first_name" id="id_1-first_name" class="form-input w-full border-2 border-green-200 focus:border-green-400 focus:ring-0 py-2 px-3 rounded-lg" placeholder="Enter first name" value="{{ forms.0.first_name.value|default_if_none:'' }}" required>
                            {% if forms.0.first_name.errors %}
                                <p class="text-red-500 text-xs">{{ forms.0.first_name.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Last Name -->
                        <div class="mb-4">
                            <label for="id_1-last_name" class="block text-sm font-medium text-gray-700">Last Name:</label>
                            <input type="text" name="1-last_name" id="id_1-last_name" class="form-input w-full border-2 border-green-200 focus:border-green-400 focus:ring-0 py-2 px-3 rounded-lg" placeholder="Enter last name" value="{{ forms.0.last_name.value|default_if_none:'' }}" required>
                            {% if forms.0.last_name.errors %}
                                <p class="text-red-500 text-xs">{{ forms.0.last_name.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Mobile Number -->
                        <div class="mb-4">
                            <label for="id_1-mobile_number" class="block text-sm font-medium text-gray-700">Mobile Number:</label>
                            <input type="tel" name="1-mobile_number" id="id_1-mobile_number" class="form-input w-full border-2 border-green-200 focus:border-green-400 focus:ring-0 py-2 px-3 rounded-lg" placeholder="Enter mobile number" value="{{ forms.0.mobile_number.value|default_if_none:'' }}" required>
                            {% if forms.0.mobile_number.errors %}
                                <p class="text-red-500 text-xs">{{ forms.0.mobile_number.errors.0 }}</p>
                            {% endif %}
                        </div>

                        <!-- Email Address -->
                        <div class="mb-4">
                            <label for="id_1-email_address" class="block text-sm font-medium text-gray-700">Email Address:</label>
                            <input type="email" name="1-email_address" id="id_1-email_address" class="form-input w-full border-2 border-green-200 focus:border-green-400 focus:ring-0 py-2 px-3 rounded-lg" placeholder="Enter email address" value="{{ forms.0.email_address.value|default_if_none:'' }}" required>
                            {% if forms.0.email_address.errors %}
                                <p class="text-red-500 text-xs">{{ forms.0.email_address.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </fieldset>
                </div>
                {% for form in forms|slice:"1:" %}
                    <div id="contact-form-{{ forloop.counter|add:1 }}" class="contact-form mb-6 hidden">
                        <div class="accordion-header cursor-pointer bg-green-100 p-4 rounded-lg mb-2">
                            <legend class="text-xl font-semibold text-green-800">Contact {{ forloop.counter|add:1 }} Details</legend>
                        </div>
                        <div class="accordion-content hidden">
                            <fieldset class="mb-6 p-4 border-l-4 border-green-500">
                                <!-- First Name -->
                                <div class="mb-4">
                                    <label for="id_{{ form.prefix }}-first_name" class="block text-sm font-medium text-gray-700">First Name:</label>
                                    <input type="text" name="{{ form.prefix }}-first_name" id="id_{{ form.prefix }}-first_name" class="form-input w-full border-2 border-green-200 focus:border-green-400 focus:ring-0 py-2 px-3 rounded-lg" placeholder="Enter first name" value="{{ form.first_name.value|default_if_none:'' }}">
                                    {% if form.first_name.errors %}
                                        <p class="text-red-500 text-xs">{{ form.first_name.errors.0 }}</p>
                                    {% endif %}
                                </div>

                                <!-- Last Name -->
                                <div class="mb-4">
                                    <label for="id_{{ form.prefix }}-last_name" class="block text-sm font-medium text-gray-700">Last Name:</label>
                                    <input type="text" name="{{ form.prefix }}-last_name" id="id_{{ form.prefix }}-last_name" class="form-input w-full border-2 border-green-200 focus:border-green-400 focus:ring-0 py-2 px-3 rounded-lg" placeholder="Enter last name" value="{{ form.last_name.value|default_if_none:'' }}">
                                    {% if form.last_name.errors %}
                                        <p class="text-red-500 text-xs">{{ form.last_name.errors.0 }}</p>
                                    {% endif %}
                                </div>

                                <!-- Mobile Number -->
                                <div class="mb-4">
                                    <label for="id_{{ form.prefix }}-mobile_number" class="block text-sm font-medium text-gray-700">Mobile Number:</label>
                                    <input type="tel" name="{{ form.prefix }}-mobile_number" id="id_{{ form.prefix }}-mobile_number" class="form-input w-full border-2 border-green-200 focus:border-green-400 focus:ring-0 py-2 px-3 rounded-lg" placeholder="Enter mobile number" value="{{ form.mobile_number.value|default_if_none:'' }}">
                                    {% if form.mobile_number.errors %}
                                        <p class="text-red-500 text-xs">{{ form.mobile_number.errors.0 }}</p>
                                    {% endif %}
                                </div>

                                <!-- Email Address -->
                                <div class="mb-4">
                                    <label for="id_{{ form.prefix }}-email_address" class="block text-sm font-medium text-gray-700">Email Address:</label>
                                    <input type="email" name="{{ form.prefix }}-email_address" id="id_{{ form.prefix }}-email_address" class="form-input w-full border-2 border-green-200 focus:border-green-400 focus:ring-0 py-2 px-3 rounded-lg" placeholder="Enter email address" value="{{ form.email_address.value|default_if_none:'' }}">
                                    {% if form.email_address.errors %}
                                        <p class="text-red-500 text-xs">{{ form.email_address.errors.0 }}</p>
                                    {% endif %}
                                </div>
                            </fieldset>
                        </div>
                    </div>
                {% endfor %}
                <div class="flex justify-between mt-6">
                    <a href="{% url 'business_detail_view' %}" class="py-2 px-6 border-2 border-green-600 text-green-600 font-semibold rounded-lg hover:bg-green-50">Previous</a>
                    <button type="button" id="add-contact" class="py-2 px-6 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 mr-4">Add Another Contact</button>
                    <button type="submit" class="py-2 px-6 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700">Next</button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
{% endblock %}